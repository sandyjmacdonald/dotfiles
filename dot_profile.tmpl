export MOTD_DISABLE=1
export FLIGHT_MOTD_SUPPRESS=1
export HUSHLOGIN=1

# If on Viking and still in bash, exec straight into zsh (skip bash profile.d banners)
if [ "$(uname -s)" = "Linux" ]; then
  host_lc="$(hostname 2>/dev/null | tr '[:upper:]' '[:lower:]')"
  if [[ "$host_lc" == *viking* && -z "${ZSH_VERSION-}" ]]; then
    # initialize modules if needed to get zsh
    for f in /etc/profile.d/lmod.sh /etc/profile.d/modules.sh /usr/share/Modules/init/bash; do
      [ -f "$f" ] && . "$f"
    done
    command -v module >/dev/null 2>&1 && module load zsh/5.8-GCC-8.3.0 >/dev/null 2>&1 || true
    exec zsh -l
  fi
fi

# Viking HPC: ensure modules exist and load Neovim
if [ "$(uname -s)" = "Linux" ]; then
  host_lc="$(hostname 2>/dev/null | tr '[:upper:]' '[:lower:]')"
  if [[ "$host_lc" == *viking* ]]; then
    for f in /etc/profile.d/lmod.sh /etc/profile.d/modules.sh /usr/share/Modules/init/zsh; do
      [ -f "$f" ] && . "$f"
    done
    if command -v module >/dev/null 2>&1 && ! command -v nvim >/dev/null 2>&1; then
      module load Neovim/0.11.4-GCCcore-13.2.0 || true
    fi
  fi
fi

# For Bourne-compatible login shells that read ~/.profile (bash on some systems)
export PATH="$HOME/.local/bin:$HOME/bin:$PATH"
export EDITOR="nvim"
